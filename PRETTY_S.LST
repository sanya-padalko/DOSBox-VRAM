Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 1
pretty_s.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100h
      4
      5	      =000A		     STR_LENGTH	     equ 10d
      6
      7				     locals @@
      8
      9	0100  E8 0003		     start:	     call Main
     10	0103  E8 0129				     call Exit
     11
     12
     13				     ;=====================================================
     14				     ; Entry:	     -
     15				     ; Result:	     Program executed
     16				     ; Expected:     -
     17				     ; Destruction:  AX, BX, ES, DI, DS, SI, CL
     18				     ;=====================================================
     19	0106			     Main	     proc
     20
     21	0106  B8 0002				     mov ax, 02h
     22	0109  E8 0034				     call SkipStrings
     23
     24	010C  B8 8A2F				     mov ax, 8a2fh
     25	010F  BB 8A5C				     mov bx, 8a5ch
     26	0112  8B CB				     mov cx, bx
     27	0114  8B D0				     mov dx, ax
     28	0116  50 55 8B EC C7 46	02+		     push 8ac4h
     29	      8AC4 5D
     30	0120  50 55 8B EC C7 46	02+		     push 8a03h
     31	      8A03 5D
     32	012A  E8 0094				     call DrawHorLines
     33
     34	012D  B8 FFFD				     mov ax, -3d
     35	0130  E8 001B				     call ChangeString
     36
     37	0133  B8 8AB3				     mov ax, 8ab3h
     38	0136  BB 8AC3				     mov bx, 8ac3h
     39	0139  B9 8AB4				     mov cx, 8ab4h
     40	013C  E8 0042				     call DrawWalls
     41
     42	013F  C3				     ret
     43	0140					     endp
     44				     ;-----------------------------------------------------
     45
     46
     47
     48				     ;=====================================================
     49				     ; Entry:	     AX	= count	of empty string	before frame
     50				     ; Result:	     ES	on begin of (AX	+ 1)th string
     51				     ; Expected:     1 < AX < 21, also expect that 2 string will be entered
     52				     ; Destruction:  AX, ES, BX
     53				     ;=====================================================
     54	0140			     SkipStrings     proc
     55
     56	0140  05 0002				     add ax, 02h
     57	0143  BB 000A				     mov bx, 0ah
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 2
pretty_s.asm



     58	0146  F7 E3				     mul bx
     59	0148  05 B800				     add ax, 0b800h
     60	014B  8E C0				     mov es, ax
     61
     62	014D  C3				     ret
     63	014E					     endp
     64				     ;-----------------------------------------------------
     65
     66
     67
     68				     ;=====================================================
     69				     ; Entry:	     AX	= the number of	lines to change	to
     70				     ;		     ES	= ...
     71				     ; Result:	     ES	= old ES + AX strings
     72				     ;		     AX	= ES
     73				     ; Expected:     -
     74				     ;
     75				     ; Destruction:  ES, AX
     76				     ;=====================================================
     77	014E			     ChangeString    proc
     78
     79	014E  53				     push bx
     80	014F  52				     push dx
     81	0150  BB 000A				     mov bx, 10d
     82	0153  F7 E3				     mul bx
     83
     84	0155  8C C3				     mov bx, es
     85	0157  03 C3				     add ax, bx
     86	0159  8E C0				     mov es, ax
     87
     88	015B  5A				     pop dx
     89	015C  5B				     pop bx
     90	015D  C3				     ret
     91	015E					     endp
     92				     ;-----------------------------------------------------
     93
     94
     95
     96				     ;=====================================================
     97				     ; Entry:	     CX	= length of string
     98				     ;
     99				     ; Result:	     DI	= right	offset for string with len CX
    100				     ;
    101				     ; Expected:     0 <= CX < 76d
    102				     ;
    103				     ; Destruction:  DI
    104				     ;=====================================================
    105	015E			     CalcOffset	     proc
    106
    107	015E  BF 004C				     mov di, 76d
    108	0161  2B F9				     sub di, cx
    109	0163  D1 EF D1 EF			     shr di, 2d
    110	0167  D1 E7				     sal di, 1d
    111
    112	0169  C3				     ret
    113	016A					     endp
    114				     ;-----------------------------------------------------
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 3
pretty_s.asm



    115
    116
    117
    118				     ;=====================================================
    119				     ; Entry:	     [80h]     = lenght	of string
    120				     ;		     [81h]     = space
    121				     ;		     [82h-...] = string
    122				     ;		     AH	       = color of string's symbols
    123				     ;		     ES:[DI]   = index of memory, from which printing will start
    124				     ;
    125				     ; Result:	     print string from command line (without first space)
    126				     ;		     started from es:[di]
    127				     ;
    128				     ; Expected:     STRING ISN'T EMPTY	and not	too long ( < 126d symbols)
    129				     ;
    130				     ; Destruction:  DI, SI, AL, CX, BX
    131				     ;=====================================================
    132	016A			     PrintString     proc
    133
    134	016A  E8 000C				     call GetLength
    135	016D  83 C3 02				     add bx, 02h
    136	0170  8B F3				     mov si, bx
    137
    138	0172  AC			    @@print: lodsb
    139	0173  AB				     stosw
    140
    141	0174  FE C9				     dec cl
    142	0176  75 FA				     jne @@print
    143
    144	0178  C3				     ret
    145	0179					     endp
    146				     ;-----------------------------------------------------
    147
    148
    149
    150				     ;=====================================================
    151				     ; Entry:	     [80h] = length of string
    152				     ;
    153				     ; Result:	     CX	= length of string
    154				     ;		     BX	= 80h
    155				     ;
    156				     ; Expected:     -
    157				     ;
    158				     ; Destruction:  BX, CX
    159				     ;=====================================================
    160	0179			     GetLength	     proc
    161
    162	0179  BB 0080				     mov bx, 80h
    163	017C  8A 0F				     mov cl, [bx]
    164	017E  B5 00				     mov ch, 0h
    165
    166	0180  C3				     ret
    167	0181					     endp
    168				     ;-----------------------------------------------------
    169
    170
    171
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 4
pretty_s.asm



    172				     ;=====================================================
    173				     ; Entry:	     AX	= wall's symbol
    174				     ;		     BX	= left central wall's symbol
    175				     ;		     CX	= right	central	wall's symbol
    176				     ;
    177				     ; Result:	     DX	= CX
    178				     ;		     SI	= AX
    179				     ;
    180				     ; Expected:     DI	= right	offset
    181				     ;
    182				     ; Distruction:  DX, SI
    183				     ;=====================================================
    184	0181			     DrawWalls	     proc
    185	0181  8B D1				     mov dx, cx
    186	0183  8B F3				     mov si, bx
    187	0185  E8 FFF1				     call GetLength
    188	0188  80 C1 02				     add cl, 2d
    189	018B  D1 E1				     sal cx, 1d
    190
    191	018D  8B DE				     mov bx, si
    192	018F  8B F0				     mov si, ax
    193
    194	0191  AB				     stosw
    195	0192  03 F9				     add di, cx
    196	0194  AB				     stosw
    197	0195  2B F9				     sub di, cx
    198	0197  83 EF 04				     sub di, 4d
    199
    200	019A  B8 0001				     mov ax, 1d
    201	019D  E8 FFAE				     call ChangeString
    202
    203	01A0  8B C3				     mov ax, bx
    204	01A2  AB				     stosw
    205	01A3  03 F9				     add di, cx
    206	01A5  8B C2				     mov ax, dx
    207	01A7  AB				     stosw
    208	01A8  2B F9				     sub di, cx
    209	01AA  83 EF 04				     sub di, 4d
    210
    211	01AD  B8 0001				     mov ax, 1d
    212	01B0  E8 FF9B				     call ChangeString
    213
    214	01B3  8B C6				     mov ax, si
    215	01B5  AB				     stosw
    216	01B6  03 F9				     add di, cx
    217	01B8  AB				     stosw
    218	01B9  2B F9				     sub di, cx
    219	01BB  83 EF 04				     sub di, 4d
    220
    221	01BE  8B CA				     mov cx, dx
    222
    223	01C0  C3				     ret
    224	01C1					     endp
    225				     ;-----------------------------------------------------
    226
    227
    228
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 5
pretty_s.asm



    229				     ;=====================================================
    230				     ; Entry:	     AX	= symbol of upleft angle
    231				     ;		     BX	= symbol of upright angle
    232				     ;		     CX	= symbol of downleft angle
    233				     ;		     DX	= symbol of downright angle
    234				     ;
    235				     ; Result:	     AX	= returning address
    236				     ;		     BX	= 80h
    237				     ;		     SI	= CX
    238				     ;		     DI	= right	offset
    239				     ;
    240				     ; Expected:     -
    241				     ;
    242				     ; Destruction:  AX, BX, SI, DI
    243				     ;=====================================================
    244	01C1			     DrawHorLines    proc    mid1, mid2
    245	01C1  55				     push bp
    246	01C2  8B EC				     mov bp, sp
    247
    248	01C4  8B F1				     mov si, cx
    249
    250	01C6  50				     push ax
    251	01C7  53				     push bx
    252	01C8  FF 76 04				     push mid1
    253	01CB  E8 FFAB				     call GetLength
    254	01CE  E8 FF8D				     call CalcOffset
    255	01D1  80 C1 02				     add cl, 2d
    256	01D4  51				     push cx
    257	01D5  57				     push di
    258	01D6  E8 001F				     call BoundedHorLine
    259
    260	01D9  E8 FF9D				     call GetLength
    261	01DC  80 C1 02				     add cl, 2
    262
    263	01DF  B8 0004				     mov ax, 04h
    264	01E2  E8 FF69				     call ChangeString
    265
    266	01E5  56				     push si
    267	01E6  52				     push dx
    268	01E7  FF 76 06				     push mid2
    269	01EA  51				     push cx
    270	01EB  57				     push di
    271	01EC  E8 0009				     call BoundedHorLine
    272
    273	01EF  8B CE				     mov cx, si
    274	01F1  5D				     pop bp
    275	01F2  58				     pop ax
    276	01F3  83 C4 04				     add sp, 4d
    277	01F6  50				     push ax
    278	01F7  C3				     ret
    279	01F8					     endp
    280				     ;-----------------------------------------------------
    281
    282
    283
    284				     ;=====================================================
    285				     ; BoundedHorLine(lbound, rbound, symb, len, ind)
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 6
pretty_s.asm



    286				     ;
    287				     ; Entry:	     lbound  = symbol for line's start
    288				     ;		     rbound  = symbol for line's end
    289				     ;		     symb    = symbol of line's	middle
    290				     ;		     len     = len of line's middle
    291				     ;		     ind     = index from which	line will be printing (es:[ind])
    292				     ;
    293				     ; Result:	     di	     = ind
    294				     ;		     AX	     = returing	address
    295				     ;		     CX	     = 0
    296				     ;
    297				     ; Expected:     argument direction	-> Pascal, len >= 0
    298				     ;
    299				     ; Destruction:  AX, CX
    300				     ;=====================================================
    301	01F8			     BoundedHorLine  proc
    302
    303	01F8  55				     push bp
    304	01F9  8B EC				     mov bp, sp
    305
    306	01FB  8B 7E 04				     mov di, [bp + 4]
    307	01FE  8B 4E 06				     mov cx, [bp + 6]
    308	0201  8B 46 0C				     mov ax, [bp + 12]
    309
    310	0204  AB				     stosw
    311
    312	0205  8B 46 08				     mov ax, [bp + 8]
    313
    314	0208  57				     push di
    315	0209  51				     push cx
    316	020A  50				     push ax
    317	020B  E8 0011				     call DrawHorLine
    318
    319	020E  8B 46 0A				     mov ax, [bp + 10]
    320	0211  AB				     stosw
    321
    322	0212  5F				     pop di
    323	0213  5F				     pop di
    324	0214  5F				     pop di
    325
    326	0215  83 EF 02				     sub di, 2d
    327
    328	0218  5D				     pop bp
    329	0219  58				     pop ax
    330	021A  83 C4 0A				     add sp, 5h	* 2h
    331	021D  50				     push ax
    332	021E  C3				     ret
    333	021F					     endp
    334				     ;-----------------------------------------------------
    335
    336
    337
    338				     ;=====================================================
    339				     ; DrawHorLine(symb, len, ind)
    340				     ;
    341				     ; Entry:	     symb    = symbol which will be printing
    342				     ;		     len     = len of line
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 7
pretty_s.asm



    343				     ;		     ind     = index of	memory,	from which hor line will be drawing
    344				     ;		     (real index = es:[ind])
    345				     ;
    346				     ; Result:	     ES:[DI] = index of	first byte after horisontal line
    347				     ;		     CX	     = 0
    348				     ;		     AX	     = symb
    349				     ;
    350				     ; Expected:     argument direction	-> CDECL, len >= 0
    351				     ;
    352				     ; Destruction:  AX, CX, DI
    353				     ;=====================================================
    354	021F			     DrawHorLine     proc symb,	len, ind
    355
    356	021F  55				     push bp
    357	0220  8B EC				     mov bp, sp
    358
    359	0222  8B 46 04				     mov ax, symb
    360	0225  8B 4E 06				     mov cx, len
    361	0228  8B 7E 08				     mov di, ind
    362
    363	022B  F3> AB				     rep stosw
    364
    365	022D  5D				     pop bp
    366	022E  C3				     ret
    367	022F					     endp
    368				     ;-----------------------------------------------------
    369
    370
    371
    372				     ;=====================================================
    373				     ; Entry:	     -
    374				     ; Result:	     Program ended
    375				     ; Expected:     -
    376				     ; Destruction:  AX
    377				     ;=====================================================
    378	022F			     Exit	     proc
    379
    380	022F  B8 4C00				     mov ax, 4c00h
    381	0232  CD 21				     int 21h
    382
    383	0234  C3				     ret
    384	0235					     endp
    385				     ;-----------------------------------------------------
    386
    387
    388
    389				     end start
Turbo Assembler	 Version 4.1	    02/14/26 26:08:16	    Page 8
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/14/26"
??FILENAME			  Text	 "pretty_s"
??TIME				  Text	 "26:08:15"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@PRINT				  Near	 DGROUP:0172
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 PRETTY_S
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BOUNDEDHORLINE			  Near	 DGROUP:01F8
CALCOFFSET			  Near	 DGROUP:015E
CHANGESTRING			  Near	 DGROUP:014E
DRAWHORLINE			  Near	 DGROUP:021F
DRAWHORLINES			  Near	 DGROUP:01C1
DRAWWALLS			  Near	 DGROUP:0181
EXIT				  Near	 DGROUP:022F
GETLENGTH			  Near	 DGROUP:0179
IND				  Number [DGROUP:BP+0008]
LEN				  Number [DGROUP:BP+0006]
MAIN				  Near	 DGROUP:0106
MID1				  Number [DGROUP:BP+0004]
MID2				  Number [DGROUP:BP+0006]
PRINTSTRING			  Near	 DGROUP:016A
SKIPSTRINGS			  Near	 DGROUP:0140
START				  Near	 DGROUP:0100
STR_LENGTH			  Number 000A
SYMB				  Number [DGROUP:BP+0004]

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0235 Word	  Public  CODE
