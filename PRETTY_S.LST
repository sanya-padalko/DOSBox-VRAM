Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 1
pretty_s.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100h
      4
      5	      =000A		     STR_LENGTH	     equ 10d
      6
      7				     locals @@
      8
      9	0100  E8 0003		     start:	     call Main
     10	0103  E8 01A1				     call Exit
     11
     12
     13				     ;=====================================================
     14				     ; Entry:	     -
     15				     ;
     16				     ; Result:	     Program executed
     17				     ;
     18				     ; Expected:     -
     19				     ;
     20				     ; Destruction:  AX, BX, ES, DI, DS, SI, CL
     21				     ;=====================================================
     22	0106			     Main	     proc
     23
     24	0106  B8 0002				     mov ax, 02h
     25	0109  E8 009C				     call SkipStrings
     26
     27	010C  B8 8A2F				     mov ax, 8a2fh
     28	010F  BB 8A5C				     mov bx, 8a5ch
     29	0112  8B CB				     mov cx, bx
     30	0114  8B D0				     mov dx, ax
     31	0116  50 55 8B EC C7 46	02+		     push 8ac4h
     32	      8AC4 5D
     33	0120  50 55 8B EC C7 46	02+		     push 8a03h
     34	      8A03 5D
     35	012A  E8 0106				     call DrawHorLines
     36
     37	012D  B8 0001				     mov ax, 1d
     38	0130  E8 0083				     call ChangeString
     39
     40	0133  B8 8AB3				     mov ax, 8ab3h
     41	0136  BB 8AC3				     mov bx, 8ac3h
     42	0139  B9 8AB4				     mov cx, 8ab4h
     43	013C  E8 00AC				     call DrawWalls
     44
     45	013F  E8 009F				     call GetLength
     46	0142  83 C7 02				     add di, 2d
     47	0145  50 55 8B EC C7 46	02+		     push 8cdah
     48	      8CDA 5D
     49	014F  50 55 8B EC C7 46	02+		     push 8cbfh
     50	      8CBF 5D
     51	0159  50 55 8B EC C7 46	02+		     push 8cc4h
     52	      8CC4 5D
     53	0163  51				     push cx
     54	0164  57				     push di
     55	0165  E8 0108				     call BoundedHorLine
     56
     57	0168  B8 0002				     mov ax, 2d
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 2
pretty_s.asm



     58	016B  E8 0048				     call ChangeString
     59
     60	016E  E8 0070				     call GetLength
     61	0171  50 55 8B EC C7 46	02+		     push 8cc0h
     62	      8CC0 5D
     63	017B  50 55 8B EC C7 46	02+		     push 8cd9h
     64	      8CD9 5D
     65	0185  50 55 8B EC C7 46	02+		     push 8cc4h
     66	      8CC4 5D
     67	018F  51				     push cx
     68	0190  57				     push di
     69	0191  E8 00DC				     call BoundedHorLine
     70
     71	0194  B8 FFFF				     mov ax, -1d
     72	0197  E8 001C				     call ChangeString
     73
     74	019A  B8 8AC4				     mov ax, 8ac4h
     75	019D  AB				     stosw
     76
     77	019E  B4 CE				     mov ah, 0ceh
     78	01A0  E8 002F				     call PrintString
     79
     80	01A3  B8 8AC4				     mov ax, 8ac4h
     81	01A6  AB				     stosw
     82
     83	01A7  C3				     ret
     84	01A8					     endp
     85				     ;-----------------------------------------------------
     86
     87
     88
     89				     ;=====================================================
     90				     ; Entry:	     AX	= count	of empty string	before frame
     91				     ;
     92				     ; Result:	     ES	on begin of (AX	+ 1)th string
     93				     ;
     94				     ; Expected:     1 < AX < 21, also expect that 2 string will be entered
     95				     ;
     96				     ; Destruction:  AX, ES, BX
     97				     ;=====================================================
     98	01A8			     SkipStrings     proc
     99
    100	01A8  05 0002				     add ax, 02h
    101	01AB  BB 000A				     mov bx, 0ah
    102	01AE  F7 E3				     mul bx
    103	01B0  05 B800				     add ax, 0b800h
    104	01B3  8E C0				     mov es, ax
    105
    106	01B5  C3				     ret
    107	01B6					     endp
    108				     ;-----------------------------------------------------
    109
    110
    111
    112				     ;=====================================================
    113				     ; Entry:	     AX	= the number of	lines to change	to
    114				     ;		     ES	= ...
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 3
pretty_s.asm



    115				     ; Result:	     ES	= old ES + AX strings
    116				     ;		     AX	= ES
    117				     ; Expected:     -
    118				     ;
    119				     ; Destruction:  ES, AX
    120				     ;=====================================================
    121	01B6			     ChangeString    proc
    122
    123	01B6  53				     push bx
    124	01B7  52				     push dx
    125	01B8  BB 000A				     mov bx, 10d
    126	01BB  F7 E3				     mul bx
    127
    128	01BD  8C C3				     mov bx, es
    129	01BF  03 C3				     add ax, bx
    130	01C1  8E C0				     mov es, ax
    131
    132	01C3  5A				     pop dx
    133	01C4  5B				     pop bx
    134	01C5  C3				     ret
    135	01C6					     endp
    136				     ;-----------------------------------------------------
    137
    138
    139
    140				     ;=====================================================
    141				     ; Entry:	     CX	= length of string
    142				     ;
    143				     ; Result:	     DI	= right	offset for string with len CX
    144				     ;
    145				     ; Expected:     0 <= CX < 76d
    146				     ;
    147				     ; Destruction:  DI
    148				     ;=====================================================
    149	01C6			     CalcOffset	     proc
    150
    151	01C6  BF 004C				     mov di, 76d
    152	01C9  2B F9				     sub di, cx
    153	01CB  D1 EF D1 EF			     shr di, 2d
    154	01CF  D1 E7				     sal di, 1d
    155
    156	01D1  C3				     ret
    157	01D2					     endp
    158				     ;-----------------------------------------------------
    159
    160
    161
    162				     ;=====================================================
    163				     ; Entry:	     [80h]     = lenght	of string
    164				     ;		     [81h]     = space
    165				     ;		     [82h-...] = string
    166				     ;		     AH	       = color of string's symbols
    167				     ;		     ES:[DI]   = index of memory, from which printing will start
    168				     ;
    169				     ; Result:	     print string from command line (without first space)
    170				     ;		     started from es:[di]
    171				     ;
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 4
pretty_s.asm



    172				     ; Expected:     STRING ISN'T EMPTY	and not	too long ( < 126d symbols)
    173				     ;
    174				     ; Destruction:  DI, SI, AL, CX, BX
    175				     ;=====================================================
    176	01D2			     PrintString     proc
    177
    178	01D2  E8 000C				     call GetLength
    179	01D5  83 C3 02				     add bx, 02h
    180	01D8  8B F3				     mov si, bx
    181
    182	01DA  AC			    @@print: lodsb
    183	01DB  AB				     stosw
    184
    185	01DC  FE C9				     dec cl
    186	01DE  75 FA				     jne @@print
    187
    188	01E0  C3				     ret
    189	01E1					     endp
    190				     ;-----------------------------------------------------
    191
    192
    193
    194				     ;=====================================================
    195				     ; Entry:	     [80h] = length of string
    196				     ;
    197				     ; Result:	     CX	= length of string
    198				     ;		     BX	= 80h
    199				     ;
    200				     ; Expected:     -
    201				     ;
    202				     ; Destruction:  BX, CX
    203				     ;=====================================================
    204	01E1			     GetLength	     proc
    205
    206	01E1  BB 0080				     mov bx, 80h
    207	01E4  8A 0F				     mov cl, [bx]
    208	01E6  B5 00				     mov ch, 0h
    209	01E8  FE C9				     dec cl
    210
    211	01EA  C3				     ret
    212	01EB					     endp
    213				     ;-----------------------------------------------------
    214
    215
    216
    217				     ;=====================================================
    218				     ; Entry:	     AX	= wall's symbol
    219				     ;		     BX	= left central wall's symbol
    220				     ;		     CX	= right	central	wall's symbol
    221				     ;
    222				     ; Result:	     DX	= CX
    223				     ;		     SI	= AX
    224				     ;
    225				     ; Expected:     DI	= right	offset
    226				     ;
    227				     ; Distruction:  DX, SI
    228				     ;=====================================================
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 5
pretty_s.asm



    229	01EB			     DrawWalls	     proc
    230	01EB  8B D1				     mov dx, cx
    231	01ED  8B F3				     mov si, bx
    232	01EF  E8 FFEF				     call GetLength
    233	01F2  80 C1 02				     add cl, 2d
    234	01F5  D1 E1				     sal cx, 1d
    235
    236	01F7  8B DE				     mov bx, si
    237	01F9  8B F0				     mov si, ax
    238
    239	01FB  AB				     stosw
    240	01FC  03 F9				     add di, cx
    241	01FE  AB				     stosw
    242	01FF  2B F9				     sub di, cx
    243	0201  83 EF 04				     sub di, 4d
    244
    245	0204  B8 0001				     mov ax, 1d
    246	0207  E8 FFAC				     call ChangeString
    247
    248	020A  8B C3				     mov ax, bx
    249	020C  AB				     stosw
    250	020D  03 F9				     add di, cx
    251	020F  8B C2				     mov ax, dx
    252	0211  AB				     stosw
    253	0212  2B F9				     sub di, cx
    254	0214  83 EF 04				     sub di, 4d
    255
    256	0217  B8 0001				     mov ax, 1d
    257	021A  E8 FF99				     call ChangeString
    258
    259	021D  8B C6				     mov ax, si
    260	021F  AB				     stosw
    261	0220  03 F9				     add di, cx
    262	0222  AB				     stosw
    263	0223  2B F9				     sub di, cx
    264	0225  83 EF 04				     sub di, 4d
    265
    266	0228  8B CA				     mov cx, dx
    267
    268	022A  B8 FFFE				     mov ax, -2d
    269	022D  E8 FF86				     call ChangeString
    270	0230  8B C6				     mov ax, si
    271
    272	0232  C3				     ret
    273	0233					     endp
    274				     ;-----------------------------------------------------
    275
    276
    277
    278				     ;=====================================================
    279				     ; Entry:	     AX	     = symbol of upleft	angle
    280				     ;		     BX	     = symbol of upright angle
    281				     ;		     CX	     = symbol of downleft angle
    282				     ;		     DX	     = symbol of downright angle
    283				     ;	     [stack] mid1    = symbol of middle	of upside
    284				     ;	     [stack] mid2    = symbol of middle	of downside
    285				     ;
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 6
pretty_s.asm



    286				     ; Result:	     AX	= returning address
    287				     ;		     BX	= 80h
    288				     ;		     SI	= CX
    289				     ;		     DI	= right	offset
    290				     ;
    291				     ; Expected:     argument's	direction -> Pascal
    292				     ;
    293				     ; Destruction:  AX, BX, SI, DI
    294				     ;=====================================================
    295	0233			     DrawHorLines    proc    mid1, mid2
    296	0233  55				     push bp
    297	0234  8B EC				     mov bp, sp
    298
    299	0236  8B F1				     mov si, cx
    300
    301	0238  50				     push ax
    302	0239  53				     push bx
    303	023A  FF 76 04				     push mid1
    304	023D  E8 FFA1				     call GetLength
    305	0240  E8 FF83				     call CalcOffset
    306	0243  80 C1 02				     add cl, 2d
    307	0246  51				     push cx
    308	0247  57				     push di
    309	0248  E8 0025				     call BoundedHorLine
    310
    311	024B  E8 FF93				     call GetLength
    312	024E  80 C1 02				     add cl, 2
    313
    314	0251  B8 0004				     mov ax, 04h
    315	0254  E8 FF5F				     call ChangeString
    316
    317	0257  56				     push si
    318	0258  52				     push dx
    319	0259  FF 76 06				     push mid2
    320	025C  51				     push cx
    321	025D  57				     push di
    322	025E  E8 000F				     call BoundedHorLine
    323
    324	0261  B8 FFFC				     mov ax, -4d
    325	0264  E8 FF4F				     call ChangeString
    326
    327	0267  8B CE				     mov cx, si
    328	0269  5D				     pop bp
    329	026A  58				     pop ax
    330	026B  83 C4 04				     add sp, 4d
    331	026E  50				     push ax
    332	026F  C3				     ret
    333	0270					     endp
    334				     ;-----------------------------------------------------
    335
    336
    337
    338				     ;=====================================================
    339				     ; BoundedHorLine(lbound, rbound, symb, len, ind)
    340				     ;
    341				     ; Entry:[stack] lbound  = symbol for line's start
    342				     ;	     [stack] rbound  = symbol for line's end
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 7
pretty_s.asm



    343				     ;	     [stack] symb    = symbol of line's	middle
    344				     ;	     [stack] len     = len of line's middle
    345				     ;	     [stack] ind     = index from which	line will be printing (es:[ind])
    346				     ;
    347				     ; Result:	     DI	     = ind
    348				     ;		     AX	     = returing	address
    349				     ;		     CX	     = 0
    350				     ;
    351				     ; Expected:     argument's	direction -> Pascal, len >= 0
    352				     ;
    353				     ; Destruction:  AX, CX
    354				     ;=====================================================
    355	0270			     BoundedHorLine  proc
    356
    357	0270  55				     push bp
    358	0271  8B EC				     mov bp, sp
    359
    360	0273  8B 7E 04				     mov di, [bp + 4]
    361	0276  8B 4E 06				     mov cx, [bp + 6]
    362	0279  8B 46 0C				     mov ax, [bp + 12]
    363
    364	027C  AB				     stosw
    365
    366	027D  8B 46 08				     mov ax, [bp + 8]
    367
    368	0280  57				     push di
    369	0281  51				     push cx
    370	0282  50				     push ax
    371	0283  E8 0011				     call DrawHorLine
    372
    373	0286  8B 46 0A				     mov ax, [bp + 10]
    374	0289  AB				     stosw
    375
    376	028A  5F				     pop di
    377	028B  5F				     pop di
    378	028C  5F				     pop di
    379
    380	028D  83 EF 02				     sub di, 2d
    381
    382	0290  5D				     pop bp
    383	0291  58				     pop ax
    384	0292  83 C4 0A				     add sp, 5h	* 2h
    385	0295  50				     push ax
    386	0296  C3				     ret
    387	0297					     endp
    388				     ;-----------------------------------------------------
    389
    390
    391
    392				     ;=====================================================
    393				     ; DrawHorLine(symb, len, ind)
    394				     ;
    395				     ; Entry:[stack] symb    = symbol which will be printing
    396				     ;	     [stack] len     = len of line
    397				     ;	     [stack] ind     = index of	memory,	from which hor line will be drawing
    398				     ;		     (real index = es:[ind])
    399				     ;
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 8
pretty_s.asm



    400				     ; Result:	     ES:[DI] = index of	first byte after horisontal line
    401				     ;		     CX	     = 0
    402				     ;		     AX	     = symb
    403				     ;
    404				     ; Expected:     argument direction	-> CDECL, len >= 0
    405				     ;
    406				     ; Destruction:  AX, CX, DI
    407				     ;=====================================================
    408	0297			     DrawHorLine     proc symb,	len, ind
    409
    410	0297  55				     push bp
    411	0298  8B EC				     mov bp, sp
    412
    413	029A  8B 46 04				     mov ax, symb
    414	029D  8B 4E 06				     mov cx, len
    415	02A0  8B 7E 08				     mov di, ind
    416
    417	02A3  F3> AB				     rep stosw
    418
    419	02A5  5D				     pop bp
    420	02A6  C3				     ret
    421	02A7					     endp
    422				     ;-----------------------------------------------------
    423
    424
    425
    426				     ;=====================================================
    427				     ; Entry:	     -
    428				     ; Result:	     Program ended
    429				     ; Expected:     -
    430				     ; Destruction:  AX
    431				     ;=====================================================
    432	02A7			     Exit	     proc
    433
    434	02A7  B8 4C00				     mov ax, 4c00h
    435	02AA  CD 21				     int 21h
    436
    437	02AC  C3				     ret
    438	02AD					     endp
    439				     ;-----------------------------------------------------
    440
    441
    442
    443				     end start
Turbo Assembler	 Version 4.1	    02/14/26 26:40:22	    Page 9
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/14/26"
??FILENAME			  Text	 "pretty_s"
??TIME				  Text	 "26:40:21"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@PRINT				  Near	 DGROUP:01DA
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 PRETTY_S
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BOUNDEDHORLINE			  Near	 DGROUP:0270
CALCOFFSET			  Near	 DGROUP:01C6
CHANGESTRING			  Near	 DGROUP:01B6
DRAWHORLINE			  Near	 DGROUP:0297
DRAWHORLINES			  Near	 DGROUP:0233
DRAWWALLS			  Near	 DGROUP:01EB
EXIT				  Near	 DGROUP:02A7
GETLENGTH			  Near	 DGROUP:01E1
IND				  Number [DGROUP:BP+0008]
LEN				  Number [DGROUP:BP+0006]
MAIN				  Near	 DGROUP:0106
MID1				  Number [DGROUP:BP+0004]
MID2				  Number [DGROUP:BP+0006]
PRINTSTRING			  Near	 DGROUP:01D2
SKIPSTRINGS			  Near	 DGROUP:01A8
START				  Near	 DGROUP:0100
STR_LENGTH			  Number 000A
SYMB				  Number [DGROUP:BP+0004]

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  02AD Word	  Public  CODE
